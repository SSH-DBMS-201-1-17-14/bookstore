下面实现给一个查询字符串和需要查询的内容（title之类的），进行分词，得到分词列表terms

然后从表中读取关键词对应的id，得到这些id的重要程度打分（含terms中词项的个数/id对应字符串（例如：标题）本身分词长度）



1.对包含用户输入分词的id，计算 出现分词次数/它原本的分词数

```python
def split_user_input(string):
    new_string = re.sub(r'[^\w\s]', '',string)
    terms = jieba.lcut(new_string)
    while ' ' in terms:
           terms.remove(' ')
    while '\n' in terms:
           terms.remove('\n')
        
    return terms
    
```



2.从表中根据用户输入的分词找到对应的id

```python
# 使用倒排索引表，找到包含terms分词列表的id:
# 注，出现多次，则重复添加。 如用户输入“三毛的三毛”，则有：'三毛': ['1000134', '1009273', '1000134', '1009273']
def find_ids(terms,index_dic):
    term_in_id = {}
    for i in range(len(terms)):
        term = terms[i]
        if term in index_dic.keys():
            value_ids = index_dic[term]
            if term not in term_in_id.keys():
                term_in_id[term] = value_ids
            else:
                term_in_id[term] =term_in_id[term] + value_ids
                print(index_dic[term])
    return term_in_id
```



3 对包含用户输入分词的id，计算 出现分词次数/它原本的分词数

```python
# 得到重要程度打分
# 输入：
#term_in_id：{'三毛': ['1000134', '1009273', '1000134', '1009273'], '书': ['1008732']}
# freqdic：id对应字符串（比如标题）的分词数字典 {'1000067': 2,'1000134': 3,……}
def sort_id_importance(term_in_id,freqdic):
    reddic =  mapred(term_in_id)  #此函数见下方
    importance_score = {}
    for id_num in reddic:
        word_num =  freqdic[id_num]
        score = reddic[id_num]/word_num*1.0
        importance_score[id_num ] =score 

    return importance_score 


# 这是上面用到的分函数，不单独调用
# 得到id所包含的用户输入分词个数 返回一个列表
# 例如 输入：{'三毛': ['1000134', '1009273', '1000134', '1009273'], '书': ['1008732']}
# 得到 {'1000134': 2, '1009273': 2, '1008732': 1}
def mapred(termsdic):
    idx = list(termsdic.keys())
    
    term_id_list = []  #map
    for x in idx:
        term_list = termsdic[x]
        for term in term_list:
            term_id_list.append([term,x])
            
    reddic = {} #reduce
    for x in term_id_list:
        #x[0]:词          x[1]:出现的文档id
        if x[0] not in reddic.keys():
            reddic[x[0]] = 1
        else:
            reddic[x[0]] = reddic[x[0]] +1
            
    return reddic 
```

